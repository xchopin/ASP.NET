@{
    ViewBag.Title = "Translation";
}
@using System.Xml;
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/css/select2.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/2.8.0/css/flag-icon.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.3/js/select2.min.js"></script>


<div class="container">
    <div class="row">
        <div class="col-lg-12">
            <h3 class="text-center">
                @(ViewBag.productId).xml
            </h3>
        </div>
        <form action='@Url.Action("TranslateProduct")' method="POST">
            <input type="hidden" name="productId" value="@ViewBag.productId">
            <input type="hidden" name="input_languageId" id="input_languageId">
      
           
            <div class="left-side">
                <div class="content-to-translate" style="background-color:#4a4a4a;">
                  TRANSLATION FOR<br>
                </div>

                @for (int i = 0; i < ViewBag.forms.Count; i++)
                {
                    <div id='content@(i)' class="content-to-translate">
                        @ViewBag.forms[i] <br>
                    </div>
                }

            </div>

            <div class="right-side">
                <div class="translation">
                    <div class="select-custom">
                        <select id="destination" required name="languageId">
                            <option disabled selected>Select a language</option>
                        </select>
                    </div>
                </div>
               
                @for (int i = 0; i < ViewBag.forms.Count; i++)
                {
                    <script>
                            var textarea = $('<textarea>').addClass('form-control translation')
                            var height = $('#content@(i)').height()
                            textarea.height(height + 20) // Because of the padding in css class
                            textarea.attr('name', 'translation@(i)')
                            textarea.attr('required','required')
                            $('.right-side').append(textarea)
                    </script>
                }
            </div>
            <button type='button' id='modalButton' class="square-button"><i class="fa fa-check"></i> Validate</button>
        </form>

        <!-- Modal -->
        <div id="myModal" class="modal fade" role="dialog">
            <div class="modal-dialog">

                <!-- Modal content-->
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        <h4 class="modal-title"></h4>
                    </div>
                    <div class="modal-body">
                        <p id="modalContent"></p>
                    </div>
                    <div class="modal-footer">
                        <button id='submit' class="btn btn-default" type="submit">Translate</button>
                        <button type="button" class="btn btn-danger" data-dismiss="modal">Close</button>
                    </div>
                </div>

            </div>
        </div>

    </div>
</div>

<script>

$('#submit').click(function () {
  $('form').submit()
})

    $('#modalButton').click(function () {
        var res = true;
        $('textarea').each(function () {
            console.log($(this).val())
            if (!(/^(?!\d+$)[^>#<]+$/.test($(this).val()))) {
                $('.modal-title').text('Something went wrong')
                $('#modalContent').html('<i class="fa fa-warning"></i> Only letters and numbers.')
                $('.modal-footer').hide()
                $("#myModal").modal()
                res = false
                return false
            } else if (!$(this).val()) {
                $('.modal-title').text('Something went wrong')
                $('#modalContent').html('<i class="fa fa-warning"></i> Some fields are empty.')
                $('.modal-footer').hide()
                $("#myModal").modal()
                res = false
                return false
            }
        });
        if (res) {
            $('.modal-title').text('Confirmation')
            $('#modalContent').text('Before to continue, please check the fields you filled.')
            $('.modal-footer').show()
            $("#myModal").modal()
        }
    })


   
           var isoCountries = [
           @foreach (XmlNode node in ViewBag.languages)
           {
            @:{ id: '@node.Attributes["id"].Value', text: '@node.Attributes["name"].Value' },
           }
           ]
    
  
           function formatCountry(country) {
               if (!country.id) { return country.text; }
               var $country = $(
                   '<span class="flag-icon flag-icon-' + country.id.toLowerCase() + ' flag-icon-squared"></span>' +
                   '<span class="flag-text">' + country.text + "</span>"
               );
               return $country;
           }

               

            $("[name='languageId']").select2().on("change", function (e) {
                $('#input_languageId').val($(this).val())
           })


            $(document).ready(function () {
                $("[name='languageId']").select2({
                    placeholder: "Select a country",
                    templateResult: formatCountry,
                    data: isoCountries
                });
            });

</script>

